// Generated by CoffeeScript 1.9.0
(function() {
  window.apiHost = "http://localhost:5000/";

  require.config({
    paths: {
      'jquery': '../lib/jquery',
      'underscore': '../lib/underscore',
      'backbone': '../lib/backbone-min',
      'text': '../lib/text',
      'fastclick': '../lib/fastclick',
      'pageslider': '../lib/pageslider',
      'ratchet': '../lib/ratchet'
    },
    waitSeconds: 15,
    shim: {
      'fastclick': {
        exports: 'FastClick'
      },
      'pageslider': {
        exports: 'PageSlider'
      },
      'underscore': {
        exports: '_'
      },
      'backbone': {
        deps: ["underscore", "jquery"],
        exports: 'Backbone'
      }
    }
  });

  require(["jquery", "underscore", "backbone", "routers/router", "fastclick", "ratchet"], function($, _, Backbone, AppRouter, fc, ratchet) {
    return $(function() {
      var auth, startUp;
      window.PictureTrivia = {
        Models: {},
        Collections: {},
        Views: {}
      };
      window.PictureTrivia.eventBus = _.extend({}, Backbone.Events);
      auth = function(callback) {
        var email, userId;
        email = localStorage.pictureTriviaLoginEmail;
        userId = localStorage.pictureTriviaUserId;
        if ((email != null) && (userId != null)) {
          return $.ajax({
            url: window.apiHost + "user_login",
            type: "POST",
            data: {
              email: email
            },
            success: function() {
              return callback(true);
            },
            error: function() {
              localStorage.removeItem("pictureTriviaLoginEmail");
              return callback(false);
            }
          });
        } else {
          return callback(false);
        }
      };
      startUp = function(loggedIn) {
        var app;
        app = new AppRouter();
        Backbone.history.start();
        if (loggedIn) {
          return Backbone.history.loadUrl("home");
        } else {
          return Backbone.history.loadUrl("login");
        }
      };
      $(document).ready(function() {
        auth(function(loggedIn) {
          return startUp(loggedIn);
        });
      });
      document.addEventListener('deviceready', (function() {
        StatusBar.overlaysWebView(false);
        StatusBar.backgroundColorByHexString('#ffffff');
        StatusBar.styleDefault();
        FastClick.attach(document.body);
        if (navigator.notification) {
          return window.alert = function(message, title, btnText) {
            if (title == null) {
              title = 'Picture Trivia';
            }
            if (btnText == null) {
              btnText = 'OK';
            }
            navigator.notification.alert(message, null, title, btnText);
          };
        }
      }), false);
      return $(document).on("click", "a:not([data-skip])", function(evt) {
        var href, root;
        href = {
          prop: $(this).prop("href"),
          attr: $(this).attr("href")
        };
        root = location.protocol + "//" + location.host + Backbone.history.options.root;
        if (href.prop && href.prop.slice(0, root.length) === root) {
          evt.preventDefault();
          return Backbone.history.loadUrl(href.attr);
        }
      });
    });
  });

}).call(this);
